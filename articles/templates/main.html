<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% load static %}
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
    
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>

    <!-- Google fonts -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />

    <!-- Jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

    <title>Document</title>
    <style>
    .box {
    width: 150px;
    height: 150px; 
    border-radius: 70%;
    overflow: hidden;
    }
    .profile {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    input:focus {
      outline:none;
      border:none;
    }
    
    .modal_overlay {
        width: 100%;
        height: 100%;
        position: absolute;
        left: 0;
        top: 0;
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(1.5px);
        -webkit-backdrop-filter: blur(1.5px);
    }

    .modal_window {
        background: white;
        backdrop-filter: blur(13.5px);
        -webkit-backdrop-filter: blur(13.5px);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.18);
        width: 800px;
        height: 600px;
        position: relative;
        padding: 10px;
    }

    </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg bg-light" style="position: fixed; width: 100%" >
        <div class="container-fluid" style="justify-content : space-between; flex-wrap: nowrap; min-width: 1000px" >
          <a class="navbar-brand" href="#"><img style="width: 100px" src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Instagram_logo.svg/800px-Instagram_logo.svg.png?20160616034027" alt=""></a>
            <input class="form-control me-2" style="width: 400px" type="search" placeholder="Search" aria-label="Search">
              <div>
                <span class="material-symbols-outlined">home</span>
                <span class="material-symbols-outlined">send</span>
                <span id="nav_bar_add_box" class="material-symbols-outlined">add_box</span>
                <span class="material-symbols-outlined">explore</span>
                <span class="material-symbols-outlined">favorite</span>
                <span class="material-symbols-outlined">account_circle</span>
              </div>
        </div>
  </nav>



<div style="display: flex; flex-direction: row; text-align: center; justify-content: center; padding-top: 60px; background:#FAFAFA;">
    <div style="width: 500px; min-width: 500px; margin-right:285px; ">
<!-- 피드 시작 -->
{% for feed in feed_list %}
    <div style="border: solid 1px black; background-color: white; margin: 20px 0;">
      <div style="display:flex; flex-direction: row; align-items: center; margin: 20px;">
      <div class="box" style="background: #BDBDBD; width: 50px; height: 50px; object-fit:contain;">
        <img class="profile" src="{{ feed.profile_image }}">
      </div>
        <div>
          spartaman
        </div>
      </div>
      <div><img style="width:100%" src="{% get_media_prefix %}{{ feed.image }}" alt=""></div>
      <div style="display: flex; flex-direction: row; justify-content: space-between;">
        <div>
          <span class="material-symbols-outlined">favorite</span>
          <span class="material-symbols-outlined">mode_comment</span>
          <span class="material-symbols-outlined">send</span>
        </div>
        <div>
          <span class="material-symbols-outlined">bookmark</span>
        </div>
      </div>
      <div style="margin: 0 10px; text-align: left; font-size: 14px;">김철수 <b>외 {{ feed.like_count }}명</b>이 좋아합니다.</div>
      <div style="margin: 0 10px; text-align: left; font-size: 16px;"><b>{{ feed.user_id }}</b> {{ feed.content }}</div>
      <div style="margin: 0 10px; text-align: left; font-size: 16px;"><b>sparta</b> 나도요</div>
      <div style="margin: 0 10px; text-align: left; font-size: 16px;"><b>sparta</b> 저도요</div>
      <div style="border-top:1px solid gray;">
        <input type="email" class="form-control" style="box-shadow:none; border:none; outline: none;" placeholder="댓글 달기.."></div>
    </div>
    {% endfor %}
  </div>
  
<!-- 피드끝 -->

  <div style="width: 400px; height: 1000px; position: fixed; left: 62%;">
    <div style="display:flex; flex-direction: row; align-items: center; margin: 0 10px;">
        <div class="box" style="background: #BDBDBD; width: 50px; height: 50px; object-fit:contain;">
          <img class="profile" src="https://item.kakaocdn.net/do/d84248170c2c52303db27306a00fb861f604e7b0e6900f9ac53a43965300eb9a">
        </div>
          <div style="margin-left: 10px; text-align: left;">
            <div style="font-weight: bold;">
                spartaman
            </div>
            <div style="color:gray">
                Ho Kang
            </div>
          </div>
    </div>
    <div style="display: flex; flex-direction: row; justify-content: space-between; margin-top: 20px;">
        <div style="font-weight: bold; color: gray;">
            회원님을 위한 추천
        </div>
        <div>
            <a href="#" style="font-weight: bold; color:black;text-decoration: none;">모두 보기</a> 
        </div>
    </div>
    <div>
        <div style="display:flex; flex-direction: row;justify-content: space-between; align-items: center; margin: 10px;">
            <div style="display: flex; flex-direction: row;">
                <div class="box" style="background: #BDBDBD; width: 35px; height: 35px; object-fit:contain;">
                    <img class="profile" src="https://item.kakaocdn.net/do/d84248170c2c52303db27306a00fb861f604e7b0e6900f9ac53a43965300eb9a">
                  </div>
                    <div style="margin-left: 10px; text-align: left;">
                      <div style="font-weight: bold; font-size:14px;">
                          abcabcab
                      </div>
                      <div style="color:gray">
                          sparta 님 외 10명을 팔로우합니다
                      </div>
                    </div>
            </div>
            <div>
                <a href="#" style="font-size: 14px; font-weight: bold; text-decoration: none;">팔로우</a>
            </div>
        </div>
    </div>
    <div>
        <div style="display:flex; flex-direction: row;justify-content: space-between; align-items: center; margin: 10px;">
            <div style="display: flex; flex-direction: row;">
                <div class="box" style="background: #BDBDBD; width: 35px; height: 35px; object-fit:contain;">
                    <img class="profile" src="https://item.kakaocdn.net/do/d84248170c2c52303db27306a00fb861f604e7b0e6900f9ac53a43965300eb9a">
                  </div>
                    <div style="margin-left: 10px; text-align: left;">
                      <div style="font-weight: bold; font-size:14px;">
                          abcabcab
                      </div>
                      <div style="color:gray">
                          sparta 님 외 10명을 팔로우합니다
                      </div>
                    </div>
            </div>
            <div>
                <a href="#" style="font-size: 14px; font-weight: bold; text-decoration: none;">팔로우</a>
            </div>
        </div>
    </div>
    <div>
        <div style="display:flex; flex-direction: row;justify-content: space-between; align-items: center; margin: 10px;">
            <div style="display: flex; flex-direction: row;">
                <div class="box" style="background: #BDBDBD; width: 35px; height: 35px; object-fit:contain;">
                    <img class="profile" src="https://item.kakaocdn.net/do/d84248170c2c52303db27306a00fb861f604e7b0e6900f9ac53a43965300eb9a">
                  </div>
                    <div style="margin-left: 10px; text-align: left;">
                      <div style="font-weight: bold; font-size:14px;">
                          abcabcab
                      </div>
                      <div style="color:gray">
                          sparta 님 외 10명을 팔로우합니다
                      </div>
                    </div>
            </div>
            <div>
                <a href="#" style="font-size: 14px; font-weight: bold; text-decoration: none;">팔로우</a>
            </div>
        </div>
    </div>
    <div style="margin-top: 40px; font-size: 12px; color: gray; text-align: left">소개 도움말 홍보센터 API <br>개인정보처리방침 약관 위치 인기 계정 해시태그 언어</div>
    <div style="margin-top: 20px; font-size: 12px; color: gray; text-align: left">2021 인스타그램 프롬 페이스북</div>

  </div>
</div>

<!-- 첫번째 모달 -->
<div id="first_modal" class="modal_overlay">
  <div class="modal_window">
    <div style="display: flex; flex-direction: row; justify-content: space-between;">
      <div style="width: 40px; background: gray;">
        
      </div>
      <div>
        새 이미지 업로드
      </div>
      <div style="width:40px; background: gray; ">
        <span class="material-symbols-outlined">close</span>
      </div>
    </div>
    <div class="img_upload_space" style="border-top: solid 1px gray; width:778px; height: 540px; margin-top:10px">

    </div>
  </div>
</div>

<!-- 두번째 모달 -->
<div id="second_modal" class="modal_overlay">
  <div class="modal_window">
    <div style="display: flex; flex-direction: row; justify-content: space-between;">
      <div style="width: 40px; background: gray;">
        
      </div>
      <div>
        새 이미지 업로드
      </div>
      <div style="width:40px; background: gray; ">
        <span class="material-symbols-outlined">close</span>
      </div>
    </div>

    <div style="border-top: solid 1px gray;  display: flex; flex-direction: row; margin-top:10px;">
      <div class="img_upload_space" style="width:500px; height: 540px;">

      </div>
      <div style="border-left: solid 1px gray">
        <div>
          <textarea id="input_feed_content" class="form-control" style="width:276px; height:400px;" id="exampleFormControlTextarea1" rows="5"></textarea>
        </div>
        <button id="feed_create_button" type="button" class="btn btn-primary" style="width: 100%">
          공유하기
        </button>
      </div>

    </div>

  </div>
</div>


<script>

  let files;
  
  $('#nav_bar_add_box').click(function(){
    $('#first_modal').css({
      display: 'flex'
    });

    $(document.body).css({
      overflow : 'hidden'
    });
  });

  $('.img_upload_space')
    .on("dragover", dragOver)
    .on("dragleave", dragOver)
    .on("drop", uploadFiles);
    
    function dragOver(e) {
    e.stopPropagation();
    e.preventDefault();

    console.log(e);

    if (e.type == "dragover") {
        $(e.target).css({
            "background-color": "black",
            "outline-offset": "-20px"
        });
    } else {
        $(e.target).css({
            "background-color": "orange",
            "outline-offset": "-10px"
        });
    }
  }
  
  function uploadFiles(e) {
    e.stopPropagation();
    e.preventDefault();

    e.dataTransfer = e.originalEvent.dataTransfer; //2
    files = e.target.files || e.dataTransfer.files;
    console.log("뭔가 이미지 파일을 올렸네?"+ files[0].name)
 
    if (files.length > 1) {
        alert('하나만 올려라.');
        return;
    }

    if (files[0].type.match(/image.*/)) {

      $('#first_modal').css({
        display: 'none'
      });

      $('#second_modal').css({
        display: 'flex'
      });

    $('#feed_create_button').click(function(){
      alert("공유하기 눌렀다." );

      let file = files[0];
      let image = files[0].name;
      let content = $('#input_feed_content').val();
      let user_id = 'abcdef';
      let profile_image = 'https://item.kakaocdn.net/do/d84248170c2c52303db27306a00fb861f604e7b0e6900f9ac53a43965300eb9a';
      
      let fd = new FormData();

      fd.append('file', file);
      fd.append('image', image);
      fd.append('content', content);
      fd.append('user_id', user_id);
      fd.append('profile_image', profile_image);


      $.ajax({
        url: "/content/upload",
        data: fd, 
        method: "POST",
        processData: false,
        contentType: false,

        success: function (data){
          console.log("성공");
        },
        error : function (request, status, error){
          console.log('에러')
        },
        comeplete: function(){
          console.log("완료");
          location.replace("/main");
        }
      })
    });


    $('.img_upload_space').css({
        "background-image": "url(" + window.URL.createObjectURL(files[0]) + ")",
        "outline": "none",
        "background-size": "100%",
        "background-repeat": "no-repeat",
        "background-position": "center",
    });

    } else {
      alert('이미지가 아닙니다.');
      return;
    }

}


</script>


</body>
</html>